---
- name: Create local repo 
  file: path="{{ local_repo }}" state=directory

- name: Check out hosts repo
  git:
    repo: 'https://github.com/bmquiroz/hosts.git'
    dest: /inventory

- name: Update hosts file
  shell: |
    MASTER_IP=($(sed -n '/masters/,/managers/{/masters/!{/managers/!p}}' hosts))
    if [ -z "$MASTER_IP" ]
    then
      sed -i "/masters/a $LOCAL_IP" hosts
    else
      sed -i "/managers/a $LOCAL_IP" hosts
    fi
    exit 0
  delegate_to: localhost

